<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Vue Passager MSFS</title>
  <script src="https://cdn.jsdelivr.net/npm/cesium@1.111.0/Build/Cesium/Cesium.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/cesium@1.111.0/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <style>
    html, body, #cesiumContainer {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #logbox {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.6);
      color: lime;
      padding: 10px;
      font-size: 14px;
      border-radius: 6px;
      max-width: 300px;
      max-height: 150px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    #callsign {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.5);
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      font-weight: bold;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <div id="callsign">Volant en cours‚Ä¶</div>
  <div id="logbox">üîÑ Initialisation de la connexion √† MSFS‚Ä¶</div>

  <script>
    // Cl√© API Cesium ion (gratuite, remplace par la tienne si n√©cessaire)
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4N2QzNDMyNy0yN2I5LTRjYTQtYWY4Ny0wMTJiYzMxMTg0NWUiLCJpZCI6MjExODk3LCJpYXQiOjE3NDkzODM4NjJ9.-gzSpbdgPagQUWw9PxgljLi-hQtVaohFj185K2XqvFs';

    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrainProvider: Cesium.createWorldTerrain(),
      timeline: false,
      animation: false,
      baseLayerPicker: false,
      geocoder: false,
      homeButton: false,
      sceneModePicker: false,
      navigationHelpButton: false,
      infoBox: false,
      selectionIndicator: false
    });

    const log = (txt) => {
      const box = document.getElementById("logbox");
      box.textContent = `üß≠ ${txt}\n\n` + box.textContent;
    };

    const callsign = "MSFS Companion"; // Tu peux remplacer dynamiquement plus tard
    document.getElementById("callsign").textContent = callsign;

    // Suivi position MSFS
    const ip = "192.168.1.126:4000";
    const url = `http://${ip}/api/position`;

    const updateInterval = 1000; // ms
    let firstMove = true;

    setInterval(() => {
      fetch(url)
        .then(res => res.json())
        .then(data => {
          const lat = data.latitude;
          const lon = data.longitude;
          const alt = data.altitude;

          log(`Lat: ${lat.toFixed(5)}\nLon: ${lon.toFixed(5)}\nAlt: ${alt.toFixed(1)} ft`);

          viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(lon, lat, alt + 300),
            orientation: {
              heading: Cesium.Math.toRadians(0),
              pitch: Cesium.Math.toRadians(-30),
              roll: 0
            },
            duration: firstMove ? 2.0 : 0.5
          });

          firstMove = false;
        })
        .catch(err => {
          log("‚ùå Erreur de r√©cup√©ration MSFS:\n" + err.message);
        });
    }, updateInterval);
  </script>
</body>
</html>
