<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Suivi MSFS avec Cesium - Terrain 3D</title>
  <script src="https://unpkg.com/cesium/Build/Cesium/Cesium.js"></script>
  <link href="https://unpkg.com/cesium/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <style>
    html, body, #cesiumContainer {
      margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden;
      font-family: monospace;
      background-color: #000;
      color: #0f0;
    }
    #logbox {
      position: absolute;
      top: 10px; left: 10px;
      background: rgba(0, 0, 0, 0.7);
      color: #00ff88;
      padding: 10px;
      border-radius: 6px;
      max-width: 320px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      z-index: 1000;
      font-size: 13px;
    }
    #info {
      position: absolute;
      bottom: 10px; left: 10px;
      background: rgba(255,255,255,0.9);
      padding: 8px 12px;
      border-radius: 8px;
      font-family: sans-serif;
      font-size: 14px;
      color: #000;
      z-index: 1000;
      min-width: 280px;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <div id="logbox">[‚è≥] Initialisation Cesium...</div>
  <div id="info">Chargement position...</div>

  <script>
    // Ta cl√© API Cesium Ion (remplace par ta propre cl√© si tu veux)
    Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4N2QzNDMyNy0yN2I5LTRjYTQtYWY4Ny0wMTJiYzMxMTg0NWUiLCJpZCI6MjExODk3LCJpYXQiOjE3NDkzODM4NjJ9.-gzSpbdgPagQUWw9PxgljLi-hQtVaohFj185K2XqvFs';

    const username = "kykygosed";  // Remplace par ton pseudo Volanta si besoin
    const logbox = document.getElementById('logbox');
    const info = document.getElementById('info');

    function log(msg) {
      const time = new Date().toLocaleTimeString();
      logbox.innerText += `\n[${time}] ${msg}`;
      logbox.scrollTop = logbox.scrollHeight;
    }

    log(`üë§ Utilisateur Volanta : ${username}`);

    // Initialisation du viewer Cesium avec terrain 3D r√©aliste
    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrainProvider: Cesium.createWorldTerrain(),
      timeline: false,
      animation: false,
      baseLayerPicker: false,
      infoBox: false,
      selectionIndicator: false,
      shouldAnimate: false
    });

    log("‚úÖ Cesium pr√™t avec terrain 3D.");

    // Fonction qui va chercher la position sur Volanta et met √† jour la cam√©ra Cesium
    async function updatePosition() {
      try {
        const res = await fetch(`https://api.volanta.app/v1/users/${username}/flight`);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        if (!data || !data.aircraft) {
          info.innerText = "Aucun vol en cours.";
          log("‚ö†Ô∏è Aucun vol d√©tect√©.");
          return;
        }

        const lat = data.aircraft.latitude;
        const lon = data.aircraft.longitude;
        const altFeet = data.aircraft.altitude;
        const altMeters = altFeet * 0.3048 + 300; // conversion ft -> m + 300m hauteur cam√©ra
        const heading = data.aircraft.heading;

        viewer.camera.setView({
          destination: Cesium.Cartesian3.fromDegrees(lon, lat, altMeters),
          orientation: {
            heading: Cesium.Math.toRadians(heading),
            pitch: Cesium.Math.toRadians(-15),
            roll: 0
          }
        });

        info.innerText = `üìç LAT: ${lat.toFixed(4)} | LON: ${lon.toFixed(4)} | ALT: ${Math.round(altMeters)} m | CAP: ${heading}¬∞`;
        log(`üì° Position re√ßue : ${lat.toFixed(4)}, ${lon.toFixed(4)} √† ${Math.round(altMeters)}m`);
      } catch (e) {
        info.innerText = "Erreur r√©cup√©ration Volanta.";
        log("‚ùå Erreur fetch Volanta : " + e.message);
      }
    }

    updatePosition();
    setInterval(updatePosition, 3000);
  </script>
</body>
</html>
