<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Passenger View - MSFS</title>
  <script src="https://cdn.jsdelivr.net/npm/cesium@1.111.0/Build/Cesium/Cesium.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/cesium@1.111.0/Build/Cesium/Widgets/widgets.css" rel="stylesheet" />
  <style>
    html, body, #cesiumContainer {
      width: 100%;
      height: 100%;
      margin: 0; padding: 0; overflow: hidden;
    }
    #logbox {
      position: absolute;
      bottom: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
      max-width: 300px;
      border-radius: 5px;
      white-space: pre-line;
    }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <div id="logbox">üîÑ Initialisation...</div>

  <script>
    // Initialise Cesium Viewer sans terrain (ou terrain simple)
    const viewer = new Cesium.Viewer('cesiumContainer', {
      terrainProvider: Cesium.createWorldTerrain(),
      timeline: false,
      animation: false,
      baseLayerPicker: false
    });

    const logbox = document.getElementById("logbox");
    const apiUrl = 'http://192.168.1.126:4000/api/position'; // URL compl√®te de ton serveur distant Node.js

    function log(msg) {
      logbox.innerText = msg;
    }

    async function fetchPosition() {
      try {
        log("üîÑ R√©cup√©ration de la position...");
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        const data = await response.json();

        const { lat, lon, alt, hdg, groundspeed } = data;

        log(`üìç Position re√ßue :
Lat: ${lat.toFixed(4)}
Lon: ${lon.toFixed(4)}
Alt: ${alt} ft
GS: ${groundspeed} kt
HDG: ${hdg}¬∞`);

        // Positionner la cam√©ra sur la position re√ßue
        viewer.camera.setView({
          destination: Cesium.Cartesian3.fromDegrees(lon, lat, alt * 0.3048 + 100),
          orientation: {
            heading: Cesium.Math.toRadians(hdg),
            pitch: Cesium.Math.toRadians(-10),
            roll: 0
          }
        });
      } catch (error) {
        log(`‚ùå Erreur de r√©cup√©ration : ${error.message}`);
      }
    }

    // Actualise toutes les 2s
    setInterval(fetchPosition, 2000);
    fetchPosition();
  </script>
</body>
</html>
